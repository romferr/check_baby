{% extends 'base.html' %}

{% block head %}

    {# jQuery #}
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    {# bootstraps #}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    {# dataTable #}
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.12.1/css/jquery.dataTables.css">
    <script type="text/javascript" charset="utf8"
            src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.js"></script>
    {# font awesome #}
    <script src="https://kit.fontawesome.com/33bea16cff.js" crossorigin="anonymous"></script>
{% endblock %}

{% block bootstrapInclude %}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>
{% endblock %}

{% block body %}
    <table id="table" class="table table-striped">
    <thead>
        <tr>
            <th class="align-middle text-center" rowspan="2">Date</th>
            <th class="align-middle text-center" colspan="3" >Biberon</th>
            <th class="text-center" colspan="2">Toilette</th>
            <th class="text-center" colspan="4">Soins</th>
            <th class="align-middle text-center" colspan="2">Bain</th>
            <th class="align-middle text-center" rowspan="2">Commentaires</th>
        </tr>
        <tr>
            <th class="text-center">Heure</th>
            <th class="text-center">Lait</th>
            <th class="text-center">Eau</th>
            <th class="text-center">Pipi</th>
            <th class="text-center">Selle</th>
            <th class="text-center">Yeux</th>
            <th class="text-center">Nez</th>
            <th class="text-center">Peau</th>
            <th class="text-center">Zyma-D</th>
            <th class="text-center">Eau</th>
            <th class="text-center">Savon</th>
        </tr>
    </thead>
        <tbody>
        {% for day in days %}
            {% if loop.first %}
                <tr class="table-primary" id={{ day.id }}>
            {% else %}
                <tr id={{ day.id }}>
            {% endif %}

            <td class="center text-center" rowspan={{ day.daily_cares|length }}>{{ day.date.strftime('%d / %m') }}</td>

            {% for daily in day.daily_cares %}
                <td class="center text-center">{{ day.date.strftime('%H:%M') }}</td>
                <td class="center text-center" data-name="lait"></td>
                <td class="center text-center" data-name="eau">{% if daily.type == "eau" %} {{ daily.ml }} ml{% endif %}</td>
                <td class="center text-center" data-name="pipi">{% if daily.pipi %} <i class="fa-solid fa-check switchable"></i> {% else %}
                    <i class="fa-solid fa-xmark switchable"></i></i>{% endif %}</td>
                <td class="center text-center" data-name="selle">{% if daily.selle %} <i class="fa-solid fa-check switchable"></i> {% else %}
                    <i class="fa-solid fa-xmark switchable"></i></i>{% endif %}</td>
                <td class="center text-center" data-name="yeux">{% if daily.yeux %} <i class="fa-solid fa-check switchable"></i> {% else %}
                    <i class="fa-solid fa-xmark switchable"></i></i>{% endif %}</td>
                <td class="center text-center" data-name="nez">{% if daily.nez %} <i class="fa-solid fa-check switchable"></i> {% else %}
                    <i class="fa-solid fa-xmark switchable"></i></i>{% endif %}</td>
                <td class="center text-center" data-name="peau">{% if daily.peau %} <i class="fa-solid fa-check switchable"></i> {% else %}
                    <i class="fa-solid fa-xmark switchable"></i></i>{% endif %}</td>
                <td class="center text-center" data-name="vitamine_D">{% if daily.vitamine_D %}
                    <i class="fa-solid fa-check switchable"></i> {% else %} <i class="fa-solid fa-xmark switchable"></i> </i>{% endif %}</td>
                <td class="center text-center" data-name="bain">{% if daily.bain %} <i class="fa-solid fa-check switchable"></i> {% else %}
                    <i class="fa-solid fa-xmark switchable"></i>{% endif %}</td>
                <td class="center text-center" data-name="savon">{% if daily.bain %} <i class="fa-solid fa-check switchable"></i> {% else %}
                    <i class="fa-solid fa-xmark switchable"></i>{% endif %}</td>
                <td class="center text-center" data-name="comments"></td>
                </tr>
            {% endfor %}
        {% endfor %}
        </tbody>
    </table>

    <script>
        $("i.switchable").on("click", function () {
            var element = $(this).closest('td').attr("data-name");
            var careId = $(this).closest('tr').attr('id');
            $.ajax({
                type: 'POST',
                url: '/',
                data: {
                    element,
                    careId
                }
            });
        });
    </script>
{% endblock %}